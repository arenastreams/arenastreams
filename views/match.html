<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{match.teamA}} vs {{match.teamB}} Live Stream {{match.competition}} {{match.date}} | ArenaStreams</title>
    <meta name="description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}. HD quality streaming with multiple players available.">
    <meta name="keywords" content="{{match.teamA}}, {{match.teamB}}, live stream, {{match.competition}}, {{match.sport}}, online streaming">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://arenastreams.com/match/{{match.slug}}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{match.teamA}} vs {{match.teamB}} Live Stream - {{match.competition}}">
    <meta property="og:description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://arenastreams.com/match/{{match.slug}}">
    <meta property="og:image" content="https://arenastreams.com/images/{{match.sport}}-og.jpg">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{match.teamA}} vs {{match.teamB}} Live Stream">
    <meta name="twitter:description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}.">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ffcc00',
                        dark: '#1a1a1a',
                        darker: '#0f0f0f'
                    }
                }
            }
        }
    </script>
    
    <!-- Service Worker for Ad Control -->
    <script>
        if ('serviceWorker' in navigator) {
            // Register original service worker (propeller tracking)
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Propeller Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Propeller Service Worker registration failed:', error);
                });
            
            // Register custom ad protection service worker
            navigator.serviceWorker.register('/sw-custom.js')
                .then(registration => {
                    console.log('üõ°Ô∏è ArenaStreams Ad Protection SW registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå ArenaStreams Ad Protection SW registration failed:', error);
                });
        }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SportsEvent",
        "name": "{{match.teamA}} vs {{match.teamB}}",
        "description": "Live streaming of {{match.teamA}} vs {{match.teamB}} {{match.competition}} match",
        "startDate": "{{match.date}}",
        "sport": "{{match.sport}}",
        "competitor": [
            {
                "@type": "SportsTeam",
                "name": "{{match.teamA}}"
            },
            {
                "@type": "SportsTeam", 
                "name": "{{match.teamB}}"
            }
        ],
        "location": {
            "@type": "VirtualLocation",
            "url": "https://arenastreams.com/match/{{match.slug}}"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>
</head>
<body class="bg-darker text-white min-h-screen">
    <!-- Header -->
    <header class="bg-dark border-b border-gray-800">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-2xl font-bold text-primary">üèüÔ∏è ArenaStreams</a>
                    <span class="text-gray-400 text-sm hidden md:block">Live Sports Streaming</span>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="/" class="text-gray-400 hover:text-primary transition-colors">Home</a>
                    <a href="/football" class="text-gray-400 hover:text-primary transition-colors">‚öΩ Football</a>
                    <a href="/basketball" class="text-gray-400 hover:text-primary transition-colors">üèÄ Basketball</a>
                    <a href="/tennis" class="text-gray-400 hover:text-primary transition-colors">üéæ Tennis</a>
                    <a href="/ufc" class="text-gray-400 hover:text-primary transition-colors">ü•ä UFC</a>
                    <a href="/rugby" class="text-gray-400 hover:text-primary transition-colors">üèâ Rugby</a>
                    <a href="/baseball" class="text-gray-400 hover:text-primary transition-colors">‚öæ Baseball</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <nav class="bg-dark border-b border-gray-800">
        <div class="container mx-auto px-4 py-3">
            <ol class="flex items-center space-x-2 text-sm">
                <li><a href="/" class="text-primary hover:text-yellow-400">Home</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="/{{match.sport}}" class="text-primary hover:text-yellow-400 capitalize">{{match.sport}}</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="/{{match.sport}}/{{match.competition}}" class="text-primary hover:text-yellow-400">{{match.competition}}</a></li>
                <li class="text-gray-400">/</li>
                <li class="text-white">{{match.teamA}} vs {{match.teamB}}</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Match Header -->
        <section class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl font-bold mb-4">
                {{match.teamA}} <span class="text-primary">vs</span> {{match.teamB}}
            </h1>
            <div class="flex items-center justify-center space-x-4 mb-4">
                {{#if match.teamABadge}}
                <img src="{{match.teamABadge}}" alt="{{match.teamA}}" class="w-12 h-12 rounded-full">
                {{/if}}
                <div class="text-center">
                    <p class="text-xl font-semibold text-primary">{{match.competition}}</p>
                    <p class="text-gray-400">{{match.date}}</p>
                </div>
                {{#if match.teamBBadge}}
                <img src="{{match.teamBBadge}}" alt="{{match.teamB}}" class="w-12 h-12 rounded-full">
                {{/if}}
            </div>
            <div class="flex items-center justify-center space-x-2 text-sm text-gray-400">
                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                <span>Live Stream Available</span>
            </div>
        </section>

        <!-- Stream Player Section -->
        <section class="mb-8">
            <div class="bg-dark border border-gray-800 rounded-lg overflow-hidden">
                <!-- Server Buttons -->
                <div class="border-b border-gray-800">
                    <div class="flex flex-wrap justify-center py-4" id="player-tabs-container">
                        <!-- Server buttons will be dynamically generated here -->
                    </div>
                </div>

            <!-- Player Content -->
            <div class="p-6">
                <!-- Player Container -->
                <div id="player-container">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden relative">
                        <div id="stream-placeholder" class="absolute inset-0 flex items-center justify-center bg-gray-900">
                            <div class="text-center">
                                <div class="text-6xl text-gray-600 mb-4">üì∫</div>
                                <p class="text-gray-400 mb-4">Ready to watch?</p>
                                <button id="play-btn" class="bg-primary text-dark font-bold py-3 px-8 rounded-lg hover:bg-yellow-400 transition-colors text-lg">
                                    ‚ñ∂Ô∏è Play Stream
                                </button>
                            </div>
                        </div>
                        <iframe id="stream-player" 
                                src="" 
                                frameborder="0" 
                                allowfullscreen
                                class="w-full h-full hidden">
                        </iframe>
                    </div>
                    
                    <!-- Player Controls -->
                    <div class="mt-4 text-center">
                        <button id="play-pause-btn" class="bg-primary text-dark font-bold py-2 px-6 rounded-lg hover:bg-yellow-400 transition-colors mr-4 hidden">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button id="refresh-stream-btn" class="bg-gray-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                            üîÑ Refresh Stream
                        </button>
                        <p class="text-gray-400 text-sm mt-2">
                            Click Play to start streaming. Ads may appear to support free service.
                        </p>
                    </div>
                </div>
                
                <!-- Real Banner Ad Below Player -->
                <div class="mt-6 text-center">
                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-4">
                        <p class="text-gray-400 text-sm mb-2">Advertisement</p>
                        <div id="banner-ad" class="bg-gray-700 rounded-lg p-4 text-gray-500">
                            <!-- Real Banner Ad -->
                            <iframe src="https://otieu.com/4/9879177" 
                                    width="728" height="90" 
                                    frameborder="0" 
                                    scrolling="no"
                                    style="max-width: 100%; height: auto;">
                            </iframe>
                            <p class="text-xs mt-2">728x90 Banner Ad</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Streaming Guide -->
        <section class="mb-8 max-w-4xl mx-auto">
            <div class="bg-dark border border-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-primary">üì∫ How to Watch</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">1</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Choose Your Server</h3>
                                <p class="text-gray-400 text-sm">Click on any server button above to switch between different stream sources</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">2</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Stream Loads Automatically</h3>
                                <p class="text-gray-400 text-sm">No need to click play - the stream starts loading as soon as you enter</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">3</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Use Controls</h3>
                                <p class="text-gray-400 text-sm">Pause, resume, or refresh the stream using the control buttons below</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-2">üí° Tips for Best Experience</h4>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li>‚Ä¢ Use Chrome or Firefox for best compatibility</li>
                                <li>‚Ä¢ Disable ad blockers if streams don't load</li>
                                <li>‚Ä¢ Try different servers if one doesn't work</li>
                                <li>‚Ä¢ Refresh the page if stream gets stuck</li>
                            </ul>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-2">‚ö° Quick Actions</h4>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="window.location.reload()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">üîÑ Refresh Page</button>
                                <button onclick="document.getElementById('stream-player').src = document.getElementById('stream-player').src" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">üì∫ Reload Stream</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Additional Information -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-dark border border-gray-800 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Match Details</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Teams:</span>
                            <span class="text-white">{{match.teamA}} vs {{match.teamB}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Competition:</span>
                            <span class="text-white">{{match.competition}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Date:</span>
                            <span class="text-white">{{match.date}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Sport:</span>
                            <span class="text-white capitalize">{{match.sport}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span class="text-green-500">Live</span>
                        </div>
                    </div>
                </div>

                <div class="bg-dark border border-gray-800 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Streaming Info</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Quality:</span>
                            <span class="text-white">HD</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Players:</span>
                            <span class="text-white">3 Available</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Ads:</span>
                            <span class="text-white">Minimal</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Mobile:</span>
                            <span class="text-green-500">Supported</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Cost:</span>
                            <span class="text-green-500">Free</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark border-t border-gray-800 mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center">
                <h4 class="text-xl font-bold text-primary mb-4">üèüÔ∏è ArenaStreams</h4>
                <p class="text-gray-400 text-sm mb-4">
                    Your ultimate destination for live sports streaming
                </p>
                <div class="flex justify-center space-x-6 text-sm text-gray-400">
                    <a href="/" class="hover:text-primary transition-colors">Home</a>
                    <a href="/football" class="hover:text-primary transition-colors">Football</a>
                    <a href="/basketball" class="hover:text-primary transition-colors">Basketball</a>
                    <a href="/tennis" class="hover:text-primary transition-colors">Tennis</a>
                    <a href="/ufc" class="hover:text-primary transition-colors">UFC</a>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
                    <p>&copy; 2025 ArenaStreams. All rights reserved.</p>
                    
                    <!-- DMCA Notice -->
                    <div class="mt-6 p-4 bg-gray-800 rounded-lg border border-gray-700">
                        <h6 class="text-primary font-semibold mb-3">DMCA Copyright Notice</h6>
                        <div class="text-xs text-gray-300 leading-relaxed">
                            <p class="mb-2">
                                <strong>Digital Millennium Copyright Act (DMCA) Compliance:</strong>
                            </p>
                            <p class="mb-2">
                                ArenaStreams respects the intellectual property rights of others and expects our users to do the same. 
                                We do not host, store, or transmit any copyrighted content. All streams are provided by third-party sources 
                                and are not under our control.
                            </p>
                            <p class="mb-2">
                                <strong>If you believe your copyrighted work has been used in a way that constitutes copyright infringement, 
                                please provide the following information:</strong>
                            </p>
                            <ul class="text-left list-disc list-inside mb-2 space-y-1">
                                <li>Identification of the copyrighted work claimed to have been infringed</li>
                                <li>Identification of the material that is claimed to be infringing</li>
                                <li>Your contact information (name, address, phone number, email)</li>
                                <li>A statement that you have a good faith belief that use of the material is not authorized</li>
                                <li>A statement that the information is accurate and you are authorized to act on behalf of the copyright owner</li>
                            </ul>
                            <p class="mb-2">
                                <strong>DMCA Agent Contact:</strong><br>
                                Email: dmca@arenastreams.com<br>
                                Subject: DMCA Takedown Request
                            </p>
                            <p class="text-xs text-gray-400">
                                We will respond to valid DMCA notices within 24-48 hours and remove infringing content promptly.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Service Worker for Ad Control -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Service Worker registration failed:', error);
                });
        }
    </script>
    
    <!-- Ad Scripts -->
    <script>
        // Ad configuration (moved to DOMContentLoaded)

        // Check if user has reached popup limit
        function checkPopupLimit() {
            const stored = localStorage.getItem('arenastreams_popups_' + adConfig.sessionId);
            return stored ? parseInt(stored) : 0;
        }

        function updatePopupCount(count) {
            localStorage.setItem('arenastreams_popups_' + adConfig.sessionId, count.toString());
        }

        // Trigger popup ads
        function triggerPopups(count) {
            const currentCount = checkPopupLimit();
            if (currentCount >= adConfig.maxPopupsPerSession) {
                console.log('Maximum popups reached for this session');
                return;
            }

            for (let i = 0; i < count; i++) {
                if (currentCount + i < adConfig.maxPopupsPerSession) {
                    // Simulate popup ad (replace with real ad scripts)
                    setTimeout(() => {
                        const popup = window.open('about:blank', 'popup_' + i, 'width=400,height=300');
                        if (popup) {
                            popup.document.write(`
                                <html>
                                    <head><title>Advertisement</title></head>
                                    <body style="margin:0;padding:20px;font-family:Arial;">
                                        <h3>Advertisement</h3>
                                        <p>This is a placeholder for popup ads.</p>
                                        <p>In production, this would load real ad content.</p>
                                        <button onclick="window.close()">Close</button>
                                    </body>
                                </html>
                            `);
                        }
                    }, i * 1000);
                }
            }

            updatePopupCount(currentCount + count);
        }

        // Stream player functionality (variables moved to DOMContentLoaded)
        
        // Load real streams from Streamed.pk if available
        async function loadRealStreams() {
            if (window.match && window.match.sources) {
                try {
                    console.log('üîÑ Loading real streams from Streamed.pk...');
                    console.log(`üì° Found ${window.match.sources.length} sources:`, window.match.sources);
                    
                    const allStreams = [];
                    
                    // Fetch streams from ALL sources (like football.html does)
                    for (const source of window.match.sources) {
                        try {
                            console.log(`üì° Fetching stream for source: ${source.source}, id: ${source.id}`);
                            const response = await fetch(`/api/streamed/stream/${source.source}/${source.id}`);
                            
                            if (!response.ok) {
                                console.error(`‚ùå Failed to fetch streams for source ${source.source}: ${response.status}`);
                                continue;
                            }
                            
                            const data = await response.json();
                            console.log(`üìä Stream API response for ${source.source}:`, data);

                            // The API returns streams wrapped in 'value' array
                            if (data.value && Array.isArray(data.value) && data.value.length > 0) {
                                const sourceStreams = data.value.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else if (Array.isArray(data) && data.length > 0) {
                                // Fallback for direct array response
                                const sourceStreams = data.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else if (data.streams && data.streams.length > 0) {
                                // Fallback for different response format
                                const sourceStreams = data.streams.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else {
                                console.log(`‚ö†Ô∏è No streams found for source ${source.source}`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Error fetching streams from ${source.source}:`, error);
                        }
                    }
                    
                    // Limit to 20 streams like football.html does
                    const limitedStreams = allStreams.slice(0, 20);
                    window.match.embedUrls = limitedStreams.map(stream => stream.embedUrl);
                    
                    console.log(`üì∫ Total loaded ${limitedStreams.length} real streams from ${window.match.sources.length} sources:`, window.match.embedUrls);
                    
                    // Generate player tabs dynamically based on actual stream count
                    generatePlayerTabs(limitedStreams.length);
                    
                } catch (error) {
                    console.error('‚ùå Failed to load real streams:', error);
                    // Generate default 3 player tabs on error
                    generatePlayerTabs(3);
                }
            } else {
                console.log('‚ö†Ô∏è No match sources available');
                // Generate default 3 player tabs
                generatePlayerTabs(3);
            }
        }

        // Generate player tabs dynamically based on number of streams
        function generatePlayerTabs(streamCount, forceRegenerate = false) {
            const container = document.getElementById('player-tabs-container');
            if (!container) {
                console.log('‚ùå Player tabs container not found');
                return;
            }

            // Don't regenerate if tabs already exist and we're not forcing it
            if (!forceRegenerate && container.children.length > 0) {
                console.log(`üéÆ Tabs already exist (${container.children.length}), skipping regeneration`);
                return;
            }

            container.innerHTML = '';
            console.log(`üéÆ Generating ${streamCount} player tabs...`);

            for (let i = 1; i <= streamCount; i++) {
                const tab = document.createElement('button');
                const isActive = i === 1;
                tab.className = `player-tab px-4 py-2 mx-2 rounded-lg font-semibold transition-all duration-300 ${isActive ? 'bg-primary text-dark shadow-lg transform scale-105' : 'bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white'}`;
                tab.dataset.player = i;
                tab.textContent = `Server ${i}`;
                container.appendChild(tab);
                
                console.log(`‚úÖ Created Server ${i} button${isActive ? ' (active)' : ''}`);
            }

            console.log(`üéÆ Generated ${streamCount} player tabs successfully`);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Make match data available globally
            window.match = {
                id: '{{match.id}}',
                teamA: '{{match.teamA}}',
                teamB: '{{match.teamB}}',
                competition: '{{match.competition}}',
                date: '{{match.date}}',
                slug: '{{match.slug}}',
                teamABadge: '{{match.teamABadge}}',
                teamBBadge: '{{match.teamBBadge}}',
                status: '{{match.status}}',
                poster: '{{match.poster}}',
                popular: {{match.popular}},
                sources: {{#if match.sources}}[{{#each match.sources}}{"source":"{{source}}","id":"{{id}}"}{{#unless @last}},{{/unless}}{{/each}}]{{else}}[]{{/if}},
                category: '{{match.category}}',
                sport: '{{match.sport}}'
            };

            const playBtn = document.getElementById('play-btn');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const refreshBtn = document.getElementById('refresh-stream-btn');
            const playerContainer = document.getElementById('player-container');
            const streamPlayer = document.getElementById('stream-player');
            const streamPlaceholder = document.getElementById('stream-placeholder');
            
            let currentPlayer = 1;
            let embedUrls = [];
            let isStreamPlaying = false;
            let hasPlayedBefore = false;

            // Initialize popup tracking from localStorage
            const sessionKey = 'arenastreams_popups_' + window.match.id;
            let popupCount = parseInt(localStorage.getItem(sessionKey) || '0');
            const maxPopups = 5;

            console.log(`üîÑ Initializing player tabs... Popup count: ${popupCount}/${maxPopups}`);

            // Generate default tabs first, then load real streams
            generatePlayerTabs(3); // Default 3 tabs
            loadRealStreams();

            // Real Ad popup logic with localStorage tracking
            function triggerPopups(count) {
                if (popupCount >= maxPopups) {
                    console.log('üö´ Max popups reached for this session');
                    return;
                }

                const actualCount = Math.min(count, maxPopups - popupCount);
                console.log(`üì¢ Triggering ${actualCount} REAL ad popups (${popupCount}/${maxPopups})`);

                for (let i = 0; i < actualCount; i++) {
                    popupCount++;
                    
                    // Real ad popup with your actual ad URLs
                    const adUrls = [
                        'https://otieu.com/4/9879177',
                        'https://otieu.com/4/9879176',
                        'https://otieu.com/4/9879175',
                        'https://otieu.com/4/9879174',
                        'https://otieu.com/4/9879172'
                    ];
                    
                    const randomAdUrl = adUrls[Math.floor(Math.random() * adUrls.length)];
                    
                    // Use service worker to load ad if available
                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        console.log('üõ°Ô∏è Loading ad via service worker:', randomAdUrl);
                        
                        const messageChannel = new MessageChannel();
                        navigator.serviceWorker.controller.postMessage({
                            action: 'loadAd',
                            url: randomAdUrl
                        }, [messageChannel.port2]);
                        
                        messageChannel.port1.onmessage = function(event) {
                            if (event.data.success) {
                                console.log('‚úÖ Ad loaded successfully via SW');
                                const popup = window.open(randomAdUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                                if (!popup) {
                                    console.log('‚ùå Popup blocked, trying fallback');
                                    // Fallback: redirect current window
                                    const originalUrl = window.location.href;
                                    window.location.href = randomAdUrl;
                                    setTimeout(() => {
                                        window.location.href = originalUrl;
                                    }, 3000);
                                }
                            } else {
                                console.log('‚ùå Ad load failed via SW, using direct method');
                                const popup = window.open(randomAdUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                                if (!popup) {
                                    console.log('‚ùå Popup blocked, trying fallback');
                                    const originalUrl = window.location.href;
                                    window.location.href = randomAdUrl;
                                    setTimeout(() => {
                                        window.location.href = originalUrl;
                                    }, 3000);
                                }
                            }
                        };
                    } else {
                        // Fallback: direct popup
                        console.log('üîÑ Service worker not available, using direct popup');
                        const popup = window.open(randomAdUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                        
                        if (!popup) {
                            console.log('Popup blocked by browser - trying alternative method');
                            // Fallback: redirect current window briefly
                            const originalUrl = window.location.href;
                            window.location.href = randomAdUrl;
                            setTimeout(() => {
                                window.location.href = originalUrl;
                            }, 3000);
                        }
                    }
                }

                // Save popup count to localStorage
                localStorage.setItem(sessionKey, popupCount.toString());
            }

            // Play button functionality (First/Second click logic)
            playBtn.addEventListener('click', function() {
                console.log('üé¨ Play button clicked');
                
                if (!hasPlayedBefore) {
                    // First click: Show overlay + trigger 3 popups
                    console.log('üé¨ First click - triggering 3 popups');
                    triggerPopups(3);
                    
                    // Show overlay message
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-gray-600 mb-4">‚è∏Ô∏è</div>
                            <p class="text-gray-400 mb-4">Click Resume to continue</p>
                            <button id="resume-btn" class="bg-primary text-dark font-bold py-3 px-8 rounded-lg hover:bg-yellow-400 transition-colors text-lg">
                                ‚ñ∂Ô∏è Resume Stream
                            </button>
                        </div>
                    `;
                    
                    hasPlayedBefore = true;
                    
                    // Add resume button event listener
                    document.getElementById('resume-btn').addEventListener('click', function() {
                        console.log('üé¨ Resume button clicked - triggering 2 popups');
                        triggerPopups(2);
                        startStream();
                    });
                    
                } else {
                    // This shouldn't happen with proper UI flow
                    startStream();
                }
            });

            function startStream() {
                console.log('üöÄ Starting stream...');
                
                // Load and show stream
                loadStream().then(() => {
                    // Hide placeholder, show player
                    streamPlaceholder.style.display = 'none';
                    streamPlayer.classList.remove('hidden');
                    playPauseBtn.classList.remove('hidden');
                    isStreamPlaying = true;
                    
                    console.log('‚úÖ Stream started successfully');
                });
            }

            // Play/Pause button functionality (only after stream starts)
            playPauseBtn.addEventListener('click', function() {
                if (isStreamPlaying) {
                    // Pause stream
                    streamPlayer.classList.add('hidden');
                    streamPlaceholder.style.display = 'flex';
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-gray-600 mb-4">‚è∏Ô∏è</div>
                            <p class="text-gray-400">Stream paused</p>
                        </div>
                    `;
                    playPauseBtn.innerHTML = '‚ñ∂Ô∏è Resume';
                    isStreamPlaying = false;
                } else {
                    // Resume stream
                    streamPlayer.classList.remove('hidden');
                    streamPlaceholder.style.display = 'none';
                    playPauseBtn.innerHTML = '‚è∏Ô∏è Pause';
                    isStreamPlaying = true;
                }
            });

            // Refresh stream button
            refreshBtn.addEventListener('click', function() {
                console.log('üîÑ Refreshing stream...');
                loadStream();
            });

            // Player tab switching (using event delegation for dynamic tabs)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('player-tab')) {
                    console.log('üéØ Player tab clicked:', e.target.dataset.player);
                    
                    // Update active tab
                    const allTabs = document.querySelectorAll('.player-tab');
                    allTabs.forEach(tab => {
                        tab.classList.remove('bg-primary', 'text-dark', 'shadow-lg', 'scale-105');
                        tab.classList.add('bg-gray-700', 'text-gray-300');
                    });
                    
                    e.target.classList.remove('bg-gray-700', 'text-gray-300');
                    e.target.classList.add('bg-primary', 'text-dark', 'shadow-lg', 'scale-105');
                    
                    // Update current player
                    currentPlayer = parseInt(e.target.dataset.player);
                    console.log('üîÑ Switched to player:', currentPlayer);
                    
                    // Reload stream if player is visible
                    if (!streamPlayer.classList.contains('hidden')) {
                        console.log('üîÑ Stream is visible, reloading with new player:', currentPlayer);
                        loadStream();
                    } else {
                        console.log('üîÑ Stream is hidden, not reloading');
                    }
                }
            });

            async function loadStream() {
                console.log('üé¨ Starting stream load...');
                
                try {
                    // Load real streams from Streamed.pk
                    await loadRealStreams();
                    
                    const streams = window.match.embedUrls || embedUrls;
                    console.log('üì∫ Available streams:', streams);
                    
                    if (streams && streams.length > 0) {
                        const streamUrl = streams[currentPlayer - 1] || streams[0];
                        console.log(`üì∫ Loading stream ${currentPlayer}: ${streamUrl}`);
                        streamPlayer.src = streamUrl;
                        console.log('‚úÖ Stream loaded');
                    } else {
                        // Fallback to placeholder
                        const placeholderUrl = 'https://www.youtube.com/embed/dQw4w9WgXcQ';
                        streamPlayer.src = placeholderUrl;
                        console.log('‚ö†Ô∏è No real streams available, using placeholder');
                    }
                } catch (error) {
                    console.error('‚ùå Error in loadStream:', error);
                    // Fallback to placeholder
                    const placeholderUrl = 'https://www.youtube.com/embed/dQw4w9WgXcQ';
                    streamPlayer.src = placeholderUrl;
                }
            }
        });
    </script>

    <!-- Main JavaScript -->
    <script src="/js/main.js"></script>
</body>
</html>
